apiVersion: batch/v1
kind: CronJob
metadata:
  name: cronjob

spec:
  schedule: "0 * * * *"
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        metadata:
          annotations:
            fluentbit.io/exclude: "true"
        spec:
          containers:
            - name: app
              image: public.ecr.aws/bitnami/kubectl:1.30.2@sha256:e7008983d38afc4e77a1827630654ef1a66f40f3595239a25b42b8c66450d66c
              command:
                - /bin/bash
                - -c
                - |
                  kubectl get secrets -A -o yaml > /backup/secrets_$(date +%Y%m%d).yaml
                  kubectl get configmaps -A -o yaml > /backup/configmaps_$(date +%Y%m%d).yaml
              volumeMounts:
                - name: backup
                  mountPath: /backup
              securityContext:
                allowPrivilegeEscalation: false
          volumes:
            - name: backup
              hostPath:
                path: /mnt/pool/volumes/backup-node
                type: DirectoryOrCreate
          restartPolicy: Never
          serviceAccountName: service-account
  concurrencyPolicy: Forbid
