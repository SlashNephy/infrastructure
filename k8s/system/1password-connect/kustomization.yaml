apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

helmCharts:
  # https://github.com/1Password/connect-helm-charts/tree/main/charts/connect
  - name: connect
    releaseName: connect
    namespace: 1password
    version: 2.0.3
    repo: https://1password.github.io/connect-helm-charts
    includeCRDs: true
    valuesInline:
      connect:
        create: false
      operator:
        authMethod: service-account
        autoRestart: true
        create: true
        # サービスアカウントによるレートリミットが厳しいので、当面の間は pull を無効にする
        # https://developer.1password.com/docs/service-accounts/rate-limits
        # XXX: 定期的な pull を無効化する術がないので期間を実質的に無限にする
        # https://github.com/1Password/onepassword-operator/blob/f6b267726d0bfa9c746ec75ed19f0c916367e41c/cmd/main.go#L416-L428
        pollingInterval: "2147483647" # int32 max

resources:
  - ./resources/namespace.yaml
  - ./resources/secret.yaml
