apiVersion: batch/v1
kind: CronJob
metadata:
  name: public

spec:
  schedule: "*/3 * * * *"
  jobTemplate:
    spec:
      backoffLimit: 0
      selector:
        matchLabels:
          app: public
      template:
        metadata:
          annotations:
            fluentbit.io/exclude: "true"
          labels:
            app: public
        spec:
          containers:
            - name: app
              image: public.ecr.aws/bitnami/rclone:1.66.0@sha256:c2c04212d1bdb4613c1dcf2d99940099a36add17153428e4c456c9eb28d5ec93
              args:
                - copy
                - /mnt/pool/public
                - "atmos1:public"
                - --buffer-size=1Gi
                - --drive-stop-on-upload-limit
                - --order-by=name
                - --progress
                - --ignore-existing
                - --verbose
                - --config=/config/rclone/rclone.conf
                - --rc
                - --rc-addr=0.0.0.0:5572
                - --rc-baseurl=/public
                - --rc-no-auth
                - --rc-user=user
                - --rc-pass=pass
                - --rc-web-gui
                - --rc-web-gui-no-open-browser
                - --rc-web-gui-update
              ports:
                - containerPort: 5572
              volumeMounts:
                - name: mnt
                  mountPath: /mnt
                  readOnly: true
                - name: config
                  mountPath: /config/rclone
                  readOnly: true
              securityContext:
                allowPrivilegeEscalation: false
          volumes:
            - name: mnt
              hostPath:
                path: /mnt
                type: Directory
            - name: config
              hostPath:
                path: /mnt/pool/volumes/rclone-config
                type: Directory
          restartPolicy: Never
  concurrencyPolicy: Forbid
