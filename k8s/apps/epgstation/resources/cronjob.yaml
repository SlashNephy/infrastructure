apiVersion: batch/v1
kind: CronJob
metadata:
  name: backup

spec:
  schedule: "0 * * * *"
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        spec:
          containers:
            - name: backup
              image: ghcr.io/starrybluesky/epgstation-custom-hwaccel:sha-56a2377@sha256:1f598fbbb0b725edcce6e1e6603fb4d6fa12aee2951bf3b54d42f6dd1cc44d23
              # image: ghcr.io/slashnephy/epgstation-custom-hwaccel:master@sha256:ba548bc49cd7a88ea174738874898b9f9552704554b5c0e5bd5e76b24feeed04
              command:
                - node
                - dist/DBTools.js
                - -m
                - backup
                - -o
                - /backup/epgstation.json
              volumeMounts:
                - name: backup
                  mountPath: /backup
                - name: data
                  mountPath: /app/data
                  readOnly: true
                - name: config
                  mountPath: /app/config
                  readOnly: true
              securityContext:
                allowPrivilegeEscalation: false
          volumes:
            - name: backup
              hostPath:
                path: /opt/k8s-volumes/epgstation-backup
                type: DirectoryOrCreate
            - name: data
              hostPath:
                path: /opt/k8s-volumes/epgstation-data
                type: DirectoryOrCreate
            - name: config
              hostPath:
                path: /opt/k8s-volumes/epgstation-config
                type: Directory
          restartPolicy: Never
  concurrencyPolicy: Forbid
