apiVersion: batch/v1
kind: CronJob
metadata:
  name: records2

spec:
  schedule: "2,32 * * * *"
  timeZone: Asia/Tokyo
  jobTemplate:
    spec:
      backoffLimit: 0
      template:
        spec:
          containers:
            - name: app
              image: ghcr.io/neneka/rclone:sha-87b7add@sha256:f6f29f8bac1694d456ef5c8aefbabde4326c9c07973ff9c3d342a7a27148818e
              args:
                - copy
                - /mnt/pool/records_links
                - "boxc:atmos"
                - --copy-links
                - --order-by=name
                - --ignore-existing
                - --config=/config/rclone/rclone.conf
                - --min-age=1m
                - --max-transfer=1000G
                - --log-level=INFO
              volumeMounts:
                - name: mnt
                  mountPath: /mnt
                  readOnly: true
                - name: config
                  mountPath: /config/rclone
              securityContext:
                allowPrivilegeEscalation: false
                runAsGroup: 1000
                runAsUser: 1000
              resources:
                limits:
                  cpu: 1
                  memory: 2Gi
          volumes:
            - name: mnt
              hostPath:
                path: /mnt
                type: Directory
            - name: config
              hostPath:
                path: /mnt/local/rclone-config
                type: Directory
          restartPolicy: Never
  concurrencyPolicy: Forbid
