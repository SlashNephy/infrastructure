apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: fluent-bit

helmCharts:
  - name: fluent-bit
    releaseName: fluent-bit
    namespace: fluent-bit
    version: 0.24.0
    repo: https://fluent.github.io/helm-charts
    valuesInline:
      config:
        env:
          - name: GOOGLE_APPLICATION_CREDENTIALS
            value: /gcp-service-account.json
        extraVolumeMounts:
          - name: gcp-service-account
            mountPath: /gcp-service-account.json
            readOnly: true
        extraVolumes:
          - name: gcp-service-account
            hostPath:
              path: /opt/k8s-volumes/fluent-bit/starrybluesky-8297949999e8.json
              type: File
        outputs: |
          [OUTPUT]
              Name stackdriver
              Match *
              location asia-northeast1
      imagePullSecrets:
        - name: docker-hub-credentials

resources:
  - ./resources/namespace.yaml
  - ./../../common/registry-docker-hub
