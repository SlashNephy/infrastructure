image:
  tag: v3.0

env:
  - name: TZ
    value: Asia/Tokyo

deployment:
  replicas: 2

podDisruptionBudget:
  enabled: false

experimental:
  v3:
    enabled: true
  plugins:
    enabled: false

ingressRoute:
  dashboard:
    enabled: false

updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 0
    maxSurge: 1

providers:
  kubernetesCRD:
    enabled: true
  kubernetesIngress:
    enabled: false

# https://docs.traefik.io/observability/logs/
logs:
  general:
    level: DEBUG
  access:
    enabled: true
    # https://docs.traefik.io/observability/access-logs/#limiting-the-fieldsincluding-headers
    fields:
      general:
        defaultmode: keep
        names:
          StartUTC: drop
          ClientUsername: drop
      headers:
        defaultmode: keep
        names:
          Authorization: drop
          Cookie: drop

metrics:
  prometheus: null

globalArguments:
  - --global.checknewversion

additionalArguments: []

ports:
  web:
    port: 8000
    expose: true
    exposedPort: 80
    nodePort: 8080
    protocol: TCP

  websecure:
    asDefault: true
    port: 8443
    expose: true
    exposedPort: 443
    nodePort: 8443
    protocol: TCP
    http3:
      enabled: false

    # https://doc.traefik.io/traefik/routing/entrypoints/#tls
    tls:
      enabled: true
      options: default
      domains:
        - main: starry.blue
          sans:
            - "*.starry.blue"

    forwardedHeaders:
      # https://www.cloudflare.com/ips/
      trustedIPs:
        - 173.245.48.0/20
        - 103.21.244.0/22
        - 103.22.200.0/22
        - 103.31.4.0/22
        - 141.101.64.0/18
        - 108.162.192.0/18
        - 190.93.240.0/20
        - 188.114.96.0/20
        - 197.234.240.0/22
        - 198.41.128.0/17
        - 162.158.0.0/15
        - 104.16.0.0/13
        - 104.24.0.0/14
        - 172.64.0.0/13
        - 131.0.72.0/22
        - 2400:cb00::/32
        - 2606:4700::/32
        - 2803:f800::/32
        - 2405:b500::/32
        - 2405:8100::/32
        - 2a06:98c0::/29
        - 2c0f:f248::/32

    # https://doc.traefik.io/traefik/middlewares/overview/
    # https://doc.traefik.io/traefik/routing/entrypoints/#middlewares
    middlewares:
      - traefik-security-headers@kubernetescrd
      - traefik-custom-error-pages@kubernetescrd
      # - real-ip-plugin@kubernetescrd
      - traefik-ban-robots@kubernetescrd

service:
  type: NodePort

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 60
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 60
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Pods
          value: 1
          periodSeconds: 60
